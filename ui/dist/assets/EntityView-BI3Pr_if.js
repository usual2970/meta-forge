import{l as D,r as d,b as F,u as L,n as N,p as j,q,c as E,a as K,d as l,o as P,e as T,g as m,t as S,f as o,w as c,s as w,v as x,F as A,x as G,y as R,h as v,P as I}from"./index-DyVCFT0J.js";import{S as M}from"./SettingOutlined-DSY42f78.js";const U=y=>D({url:"/api/v1/data/list",method:"get",params:y}),H={class:"flex justify-between"},J={class:"text-2xl text-slate-700"},Q={class:"flex"},W={class:"flex justify-between mt-2"},Z={__name:"EntityView",setup(y){const i=d({}),g=async e=>{const a=`${e}_dict`,n=(await G({keys:a})).data[a];n?i.value=n:i.value={plural:R(e),singular:R(e)}},k=F(),s=L(),b=d([]),p=async e=>{const a={table:e,page:r.current,pageSize:r.pageSize};let t=u.value;if(t&&t.order){let f=t.order==="ascend"?"asc":"desc";a.orderBy=`${t.field} ${f}`}const n=await U(a);n.code===0&&(b.value=n.data.data,r.total=n.data.totalRecords)};N(async()=>{console.log(s),await p(s.currentRoute.value.params.name),await g(s.currentRoute.value.params.name),await h(s.currentRoute.value.params.name)}),j(async(e,a)=>{e.params.name!==a.params.name&&(u.value=null,await p(e.params.name),await g(e.params.name),await h(e.params.name))});const u=d(),_=d({}),h=async()=>{const e=await q({key:`${s.currentRoute.value.params.name}_field_label`});e.code==0&&(_.value=e.data)},C=E(()=>{const e=u.value||{};return k.getSchemaColumns(s.currentRoute.value.params.name).map(a=>(a.key===e.columnKey&&e.order?a.sortOrder=e.order:a.sortOrder=null,_.value[a.key]&&(a.title=_.value[a.key]),a))}),r=K({total:0,current:1,pageSize:20}),z=(e,a,t)=>{r.current=e.current,r.pageSize=e.pageSize,u.value=t,p(s.currentRoute.value.params.name)},B=()=>{},O=()=>{s.push({name:"entity-setting",params:{name:s.currentRoute.value.params.name,type:"crud"}})};return(e,a)=>{const t=l("a-button"),n=l("a-breadcrumb-item"),f=l("a-breadcrumb"),V=l("a-table"),$=l("a-affix");return P(),T(A,null,[m("div",H,[m("div",J,S(i.value.plural),1),m("div",Q,[o(t,{type:"primary",onClick:B,icon:w(x(I))},{default:c(()=>[v("新增")]),_:1},8,["icon"]),o(t,{type:"default",onClick:O,class:"ml-5",icon:w(x(M))},{default:c(()=>[v("设置")]),_:1},8,["icon"])])]),m("div",W,[o(f,{class:""},{default:c(()=>[o(n,null,{default:c(()=>[v(S(i.value.plural),1)]),_:1})]),_:1})]),o($,{"offset-top":0},{default:c(()=>[o(V,{dataSource:b.value,columns:C.value,class:"my-5",size:"middle",scroll:{x:1500,y:800},pagination:r,onChange:z},null,8,["dataSource","columns","pagination"])]),_:1})],64)}}};export{Z as default};
