import{r as l,b as Q,u as W,l as X,n as Y,p as g,c as V,a as Z,d as o,o as B,e as F,g as u,t as L,f as i,w as d,q as N,s as k,F as ee,v as ae,x as E,h as x,P as te,y as j,z as I,E as se,D as ne,j as re}from"./index-C3yY4eQP.js";import{l as ie}from"./data-DSng3jim.js";import{S as le}from"./SettingOutlined-BbLpMMk1.js";const ce={class:"flex justify-between"},oe={class:"text-2xl text-slate-700"},ue={class:"flex"},de={class:"flex justify-between mt-2"},me={key:0},pe=["onClick"],ge={__name:"EntityView",setup(ve){const _=l({}),R=async e=>{const a=`${e}_dict`,s=(await ae({keys:a})).data[a];s?_.value=s:_.value={plural:E(e),singular:E(e)}},w=Q(),r=W(),C=l([]),S=async e=>{const a={table:e,page:c.current,pageSize:c.pageSize};let t=y.value;if(t&&t.order){let n=t.order==="ascend"?"asc":"desc";a.orderBy=`${t.field} ${n}`}const s=await ie(a);s.code===0&&(C.value=s.data.data,c.total=s.data.totalRecords)},m=l([]),p=l({}),v=l({}),b=l(r.currentRoute.value.params.name),D=async e=>{const a=await g({key:`${e}_crud_list`});a.code===0?m.value=a.data:m.value=[]},O=async e=>{const a=await g({key:`${e}_crud_detail`});a.code===0?p.value=a.data:p.value={checked:!0,fields:[]}},$=async e=>{const a=await g({key:`${e}_crud_delete`});a.code===0?v.value=a.data:v.value={checked:!0}};X(async()=>{await S(r.currentRoute.value.params.name),await R(r.currentRoute.value.params.name),await z(r.currentRoute.value.params.name),await D(r.currentRoute.value.params.name),await O(r.currentRoute.value.params.name),await $(r.currentRoute.value.params.name)}),Y(async(e,a)=>{e.params.name!==a.params.name&&(y.value=null,b.value=e.params.name,m.value=[],p.value={checked:!0,fields:[]},v.value={checked:!0},await S(e.params.name),await R(e.params.name),await z(e.params.name),await D(e.params.name),await O(e.params.name),await $(e.params.name))});const y=l(),f=l({}),z=async e=>{const a=await g({key:`${e}_field_label`});a.code==0&&(f.value=a.data)},K=V(()=>{const e=y.value||{};let a=[];if(m.value.length===0)a=w.getSchemaColumns(b.value).map((t,s)=>(t.key===e.columnKey&&e.order?t.sortOrder=e.order:t.sortOrder=null,f.value[t.key]&&(t.title=f.value[t.key]),s<3&&(t.fixed="left"),t));else{const t=w.getSchemaColumns(b.value).reduce((s,n)=>(n.key===e.columnKey&&e.order?n.sortOrder=e.order:n.sortOrder=null,f.value[n.key]&&(n.title=f.value[n.key]),s[n.key]=n,s),{});a=m.value.filter(s=>s.visible===!0).map((s,n)=>{const h=t[s.name];return n<3&&(h.fixed="left"),h})}return(p.value.checked||v.value.checked)&&a.push({title:"操作",dataIndex:"action",key:"action",fixed:"right",width:70,scopedSlots:{customRender:"operation"}}),a}),q=V(()=>w.getSchemaIdField(r.currentRoute.value.params.name)),P=e=>{r.push({name:"entity-detail",params:{name:r.currentRoute.value.params.name,id:e[q.value.name]}})},c=Z({total:0,current:1,pageSize:20}),T=(e,a,t)=>{c.current=e.current,c.pageSize=e.pageSize,y.value=t,S(r.currentRoute.value.params.name)},A=()=>{},G=()=>{r.push({name:"entity-setting",params:{name:r.currentRoute.value.params.name,type:"crud"}})};return(e,a)=>{const t=o("a-button"),s=o("a-breadcrumb-item"),n=o("a-breadcrumb"),h=o("a-divider"),M=o("a-table"),U=o("a-affix");return B(),F(ee,null,[u("div",ce,[u("div",oe,L(_.value.plural),1),u("div",ue,[i(t,{type:"primary",onClick:A,icon:N(k(te))},{default:d(()=>[x("新增")]),_:1},8,["icon"]),i(t,{type:"default",onClick:G,class:"ml-5",icon:N(k(le))},{default:d(()=>[x("设置")]),_:1},8,["icon"])])]),u("div",de,[i(n,{class:""},{default:d(()=>[i(s,null,{default:d(()=>[x(L(_.value.plural),1)]),_:1})]),_:1})]),i(U,{"offset-top":0},{default:d(()=>[i(M,{dataSource:C.value,columns:K.value,class:"my-5",size:"middle",scroll:{x:1500,y:800},pagination:c,onChange:T},{bodyCell:d(({column:H,record:J})=>[H.key==="action"?(B(),F("span",me,[j(u("a",{onClick:fe=>P(J)},[i(k(se))],8,pe),[[I,p.value.checked==!0]]),i(h,{type:"vertical"}),j(u("a",null,[i(k(ne))],512),[[I,v.value.checked==!0]])])):re("",!0)]),_:1},8,["dataSource","columns","pagination"])]),_:1})],64)}}};export{ge as default};
